_format_version: "3.0"
_transform: true

consumers:
  # üîë Consumer usato dai microservizi interni
  - username: intern-auth
    keyauth_credentials:
      - key: dfb6659c68c52305c5adbdc59c77b7f3d6235705327cb9bf4c37c96baf1fe1bd

  # üë§ Consumer per client esterni con JWT
  - username: tokenjwt
    jwt_secrets:
      - algorithm: HS256
        key: auth-service
        secret: your-secret-key

services:
  # -----------------------
  # AUTH SERVICE
  # -----------------------
  - name: auth
    url: http://host.docker.internal:3001
    routes:
      - name: auth-route
        paths:
          - /auth-service
 

  # -----------------------
  # LISTING SERVICE
  # -----------------------
  - name: listing
    url: http://host.docker.internal:3003
    routes:
      # üîê JWT-protetta
      - name: listing-protected
        paths:
          - /listing-service
        strip_path: true
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:4200      # dominio Angular
              methods:
                - GET
                - POST
                - PUT
                - PATCH
                - DELETE
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
                - Accept
                - Origin
              exposed_headers:
                - Authorization
              credentials: true
              max_age: 3600
          - name: jwt
            config:
              key_claim_name: iss
              claims_to_verify: [exp]
          - name: custom-jwt-headers


      # üåê Pubblica
      - name: listing-public
        paths:
          - /listing-public
        strip_path: false


      - name: listing-internal
        paths:
          - /listing-internal
        strip_path: false
        plugins:
          - name: key-auth



  # -----------------------
  # CUSTOMER SERVICE
  # -----------------------
  - name: customer
    url: http://host.docker.internal:3002
    routes:
      - name: customer-protected
        paths:
          - /customer-service
        strip_path: true
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:4200      # dominio Angular
              methods:
                - GET
                - POST
                - PUT
                - PATCH
                - DELETE
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
                - Accept
                - Origin
              exposed_headers:
                - Authorization
              credentials: true
              max_age: 3600
          - name: jwt
            config:
              key_claim_name: iss
              claims_to_verify: [exp]
          - name: custom-jwt-headers
          


      - name: customer-public
        paths:
          - /customer-public
        strip_path: false

      - name: customer-internal
        paths:
          - /customer-internal
        strip_path: false
        plugins:
          - name: key-auth



  # -----------------------
  # AGENCY SERVICE
  # -----------------------
  - name: agency
    url: http://host.docker.internal:3000
    routes:
      - name: agency-protected
        paths:
          - /agency-service
        strip_path: true
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:4200      # dominio Angular
              methods:
                - GET
                - POST
                - PUT
                - PATCH
                - DELETE
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
                - Accept
                - Origin
              exposed_headers:
                - Authorization
              credentials: true
              max_age: 3600
          - name: jwt
            config:
              key_claim_name: iss
              claims_to_verify: [exp]
          - name: custom-jwt-headers

      - name: agency-public
        paths:
          - /agency-public
        strip_path: false

      - name: agency-internal
        paths:
          - /agency-internal
        strip_path: false
        plugins:
          - name: key-auth

  # -----------------------
  # OFFER SERVICE
  # -----------------------
  - name: offer
    url: http://host.docker.internal:3004
    routes:
      - name: offer-protected
        paths:
          - /offer-service
        strip_path: true
        plugins:

          - name: cors
            config:
              origins:
                - http://localhost:4200      # dominio Angular
              methods:
                - GET
                - POST
                - PUT
                - PATCH
                - DELETE
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
                - Accept
                - Origin
              exposed_headers:
                - Authorization
              credentials: true
              max_age: 3600
          - name: jwt
            config:
              key_claim_name: iss
              claims_to_verify: [exp]
          - name: custom-jwt-headers

      - name: offer-public
        paths:
          - /offer-public
        strip_path: false

      - name: offer-internal
        paths:
          - /offer-internal
        strip_path: false
        plugins:
          - name: key-auth

  # -----------------------
  # SEARCH SERVICE
  # -----------------------
  - name: search
    url: http://host.docker.internal:3005
    routes:
      - name: search-route
        paths:
          - /search-service
        strip_path: true
